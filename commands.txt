# Basis commands for a new VM

sudo apt-get update

# Java
sudo apt-get install -y default-jre

# Language
sudo locale-gen en_CA.utf8
sudo locale-gen fr_CA.utf8

# xdebug missing configs for all php versions

# Loop on every php version in the directory /etc/php/*
phpVDirs=/etc/php/*
for phpVDir in $phpVDirs
do
        # Keep only php version and cut directory
        phpV=$(echo $phpVDir| cut -d '/' -f 4) 
        
        # Create xdebug cli
        sudo phpenmod -v $phpV xdebug

        # This will add and deletes the following lines in the simlink that link cli and fpm 20-xdebug.ini
        sudo sed -i '/xdebug.remote_connect_back/ d' /etc/php/$phpV/mods-available/xdebug.ini                 #delete
        sudo sed -i '$s/$/\nxdebug.remote_host = 192.168.10.1/' /etc/php/$phpV/mods-available/xdebug.ini      #insert
        sudo sed -i '$s/$/\nxdebug.remote_autostart=1/' /etc/php/$phpV/mods-available/xdebug.ini              #insert

        sudo service php$phpV-fpm restart
done

sudo service nginx restart
